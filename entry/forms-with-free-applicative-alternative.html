<!DOCTYPE HTML>
<html><head><title>Abstract Validating Forms with Free Applicative/Alternative · in Code</title><meta name="description" content="Weblog of Justin Le, covering his various adventures in programming and explorations in the vast worlds of computation physics, and knowledge."><meta http-equiv="Content-Type" content="text/html;charset=utf-8"><meta name="viewport" content="width=device-width,initial-scale=1.0"><meta property="og:site_name" content="in Code"><meta property="og:description" content="One tool I’ve been finding myself using a lot recently is the Free Applicative (and Free Alternative), from the free package. Free Monads are great, and they’re often used to implement the “interpreter pattern” (although I personally prefer operational, as I wrote about in a previous blog post, for that design pattern). However, Free Applicatives are really a completely different type of thing, and the use cases for each are pretty disjoint. If I had to make a general statement, I’ll say that free monads are especially good at representing the idea of abstract sequential generators (sequences that are chained dependently one after the other), and that free applicatives are especially good at representing the idea of abstract parallel generators (things operating in parallel without any interconnected data dependences). For this post, I’ll be talking about using the Free Applicative Ap (and the Free Alternative, Alt) with an abstract representation of a form element in order to generate an abstract representation of a validating form, and leveraging this representation to realize these forms in terminal IO, JSON/YAML, PDF documents, and even on the browser using ghcjs and miso."><meta property="og:type" content="article"><meta property="og:title" content="Abstract Validating Forms with Free Applicative/Alternative"><meta property="og:image" content="https://blog.jle.im/img/site_logo.jpg"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://blog.jle.im/entry/forms-with-free-applicative-alternative.html"><meta name="twitter:card" content="summary"><meta name="twitter:creator:id" content="mstk"><link rel="author" href="https://plus.google.com/107705320197444500140"><link rel="alternate" type="application/rss+xml" title="in Code (RSS Feed)" href="http://feeds.feedburner.com/incodeblog"><link rel="canonical" href="https://blog.jle.im/entry/forms-with-free-applicative-alternative.html"><link href="https://blog.jle.im/favicon.ico" rel="shortcut icon"><link href="https://blog.jle.im/css/toast.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/font.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/main.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/page/entry.css" rel="stylesheet" type="text/css"><link href="https://blog.jle.im/css/pygments.css" rel="stylesheet" type="text/css"><script type="text/javascript">var page_data = {};
var disqus_shortname='incode';
</script><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');
ga('create', 'UA-443711-8', 'jle.im');
ga('send', 'pageview');
</script><script type="text/javascript" src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5234d67a6b68dcd4"></script><script type="text/javascript" src="https://blog.jle.im/js/page/entry_toc.js"></script><script type="text/javascript" src="https://blog.jle.im/js/disqus_count.js"></script><script type="text/javascript" src="https://blog.jle.im/js/social.js"></script><script type="text/javascript" src="https://blog.jle.im/js/jquery/jquery.toc.js"></script><script type="text/javascript" src="https://blog.jle.im/purescript/entry.js"></script></head><body><div id="fb-root"><script>(function(d, s, id) {
 var js, fjs = d.getElementsByTagName(s)[0];
 if (d.getElementById(id)) return;
 js = d.createElement(s); js.id = id;
 js.src = "//connect.facebook.net/en_US/all.js#xfbml=1&appId=641852699171929";
 fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));
</script></div><div id="header-container"><div id="navbar-container" class="tile"><nav id="navbar-content"><div class="nav-info"><h1 class="site-title"><a href="https://blog.jle.im/" class="nav-title">in Code</a></h1><span class="nav-author">Justin Le</span></div><ul class="nav-links"><li><a href="https://blog.jle.im/">home</a></li><li><a href="https://blog.jle.im/entries.html">archives</a></li><div class="clear"></div></ul></nav></div><div id="header-content"></div></div><div id="body-container" class="container"><div id="main-container" class="grid"><div class="entry-section unit span-grid" role="main"><article class="tile article"><header><div class="unposted-banner">Unposted entry</div><h1 id="title">Abstract Validating Forms with Free Applicative/Alternative</h1><p class="entry-info">by <a class="author" href="https://blog.jle.im/">Justin Le</a></p><p><span class="source-info"><a class="source-link" href="https://github.com/mstksg/inCode/tree/master/copy/entries/free-applicative-forms.md">Source</a><span class="info-separator"> &diams; </span><a class="source-link" href="https://github.com/mstksg/inCode/tree/gh-pages/entry/forms-with-free-applicative-alternative.md">Markdown</a><span class="info-separator"> &diams; </span><a class="source-link" href="https://blog.jle.im/entry/forms-with-free-applicative-alternative.tex">LaTeX</a><span class="info-separator"> &diams; </span></span>Posted in <a href="https://blog.jle.im/entries/category/@haskell.html" class="tag-a-category" title="Functional, pure, non-strict, statically and strongly typed, natively
compiled...really just the king of great languages.">Haskell</a><span class="info-separator"> &diams; </span><a class="comment-link" href="#disqus_thread">Comments</a></p></header><hr><aside class="contents-container"><h5 id="contents-header">Contents</h5><div id="toc"></div></aside><div class="main-content copy-content"><p>One tool I’ve been finding myself using a lot recently is the <em>Free Applicative</em> (and <em>Free Alternative</em>), from the <em><a href="https://hackage.haskell.org/package/free">free</a></em> package.</p>
<p>Free Monads are great, and they’re often used to implement the “interpreter pattern” (although I personally prefer <em><a href="https://hackage.haskell.org/package/operational">operational</a></em>, as I wrote about in a <a href="https://blog.jle.im/entry/interpreters-a-la-carte-duet.html">previous blog post</a>, for that design pattern). However, Free Applicatives are really a completely different type of thing, and the use cases for each are pretty disjoint.</p>
<p>If I had to make a general statement, I’ll say that free monads are especially good at representing the idea of abstract <em>sequential</em> generators (sequences that are chained dependently one after the other), and that free applicatives are especially good at representing the idea of abstract <em>parallel</em> generators (things operating in parallel without any interconnected data dependences).</p>
<p>For this post, I’ll be talking about using the Free Applicative <code>Ap</code> (and the Free Alternative, <code>Alt</code>) with an abstract representation of a form element in order to generate an abstract representation of a validating form, and leveraging this representation to realize these forms in terminal IO, JSON/YAML, PDF documents, and even on the browser using <em>ghcjs</em> and <em><a href="https://hackage.haskell.org/package/miso">miso</a></em>.</p>
<h2 id="overview">Overview</h2>
<p>The general approach to utilizing the Free Applicative is to start with some Functor <code>F</code> (<code>F a</code> represents the act of generating a value of type <code>a</code>). Once you throw <code>F</code> into <code>Ap</code> to get <code>Ap F</code>, you now are able to <em>combine <code>F</code>s in parallel</em> with <code>&lt;$&gt;</code>, <code>&lt;*&gt;</code>, <code>liftA2</code>, <code>sequence</code>, <code>traverse</code>, etc., even though <code>F</code> normally could not support such combinations. Then, finally, you have the ability to provide a concrete generator function <code>forall a. Applicative f =&gt; F a -&gt; f a</code> (given <code>F a</code>, return an actual generator of <code>a</code>s in some <code>Applicative</code>), and the magic of the Free Applicative will go in and actually run all of your combined <code>F</code> actions “in parallel”. The trick is that, with the same value of <code>Ap F a</code>, you can <em>run multiple different concrete generators</em> on it, so you can realize <code>Ap F</code> in multiple different contexts and situations, adapting it for whatever you need.</p>
<p>So, in our case, we’re going to be making a Functor representing a form element:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb1-1" data-line-number="1"><span class="kw">data</span> <span class="dt">FormElem</span> a</a></code></pre></div>
<p>Where a <code>FormElem a</code> represents a <em>single form element</em> producing an <code>a</code>. A <code>FormElem Int</code>, for instance, will represent a single form element producing an <code>Int</code>.</p>
<p>Then, we can create, using <a href="https://hackage.haskell.org/package/free/docs/Control-Applicative-Free.html">Ap</a>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb2-1" data-line-number="1"><span class="kw">type</span> <span class="dt">Form</span> <span class="fu">=</span> <span class="dt">Ap</span> <span class="dt">FormElem</span></a></code></pre></div>
<p>And now we have a type where <code>Form a</code> is <em>whole form with multiple elements</em> that all work together to produce a value of type <code>a</code>!</p>
<p>For example, if we had <code>intElem :: FormElem Int</code>, then <code>liftAp intElem :: Form Int</code>, a single-item form that makes an <code>Int</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb3-1" data-line-number="1"><span class="ot">intElem ::</span> <span class="dt">FormELem</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb3-2" data-line-number="2"></a>
<a class="sourceLine" id="cb3-3" data-line-number="3"><span class="ot">intForm ::</span> <span class="dt">Form</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb3-4" data-line-number="4">intForm <span class="fu">=</span> liftAp intElem</a></code></pre></div>
<p>We can now do all of our Applicativey stuff with it, to generate, for instance, a form with two items that produces their sum:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb4-1" data-line-number="1"><span class="co">-- | A form with two elements, whose overal result is the sum of the two</span></a>
<a class="sourceLine" id="cb4-2" data-line-number="2"><span class="co">-- element&#39;s inputs</span></a>
<a class="sourceLine" id="cb4-3" data-line-number="3"><span class="ot">addingForm ::</span> <span class="dt">Form</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb4-4" data-line-number="4">addingForm <span class="fu">=</span> (<span class="fu">+</span>) <span class="fu">&lt;$&gt;</span> intForm <span class="fu">&lt;*&gt;</span> intForm</a></code></pre></div>
<p>Or, we can even generate a form with many ‘Int’ elements, and produce a list of all of their items:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb5-1" data-line-number="1"><span class="co">-- | A form with five elements, whose result is a list of all of their inputs</span></a>
<a class="sourceLine" id="cb5-2" data-line-number="2"><span class="ot">bunchaInts ::</span> <span class="dt">Form</span> [<span class="dt">Int</span>]</a>
<a class="sourceLine" id="cb5-3" data-line-number="3">bunchaInts <span class="fu">=</span> replicateM <span class="dv">5</span> intForm</a></code></pre></div>
<p>Of course, in real life, forms usually have <em>Alternative</em> instances, which allows you to use <code>&lt;|&gt;</code> to “chose” a result between potentially invalid entries, and also create “optional” entries for free using <code>optional</code>. To do that, we actually use the <em>Free Alternative</em>, <em><a href="https://hackage.haskell.org/package/free/docs/Control-Alternative-Free-Final.html">Alt</a></em>, instead:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb6-1" data-line-number="1"><span class="kw">type</span> <span class="dt">Form</span> <span class="fu">=</span> <span class="dt">Alt</span> <span class="dt">FormElem</span></a>
<a class="sourceLine" id="cb6-2" data-line-number="2"></a>
<a class="sourceLine" id="cb6-3" data-line-number="3"><span class="ot">intForm ::</span> <span class="dt">Form</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb6-4" data-line-number="4">intForm <span class="fu">=</span> liftAlt intElem</a></code></pre></div>
<p>And now we get the ability to represent forms with multiple options with <code>&lt;|&gt;</code>:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb7-1" data-line-number="1"><span class="ot">eitherInt ::</span> <span class="dt">Form</span> (<span class="dt">Either</span> <span class="dt">Int</span> <span class="dt">Int</span>)</a>
<a class="sourceLine" id="cb7-2" data-line-number="2">eitherInt <span class="fu">=</span> (<span class="dt">Left</span> <span class="fu">&lt;$&gt;</span> intForm) <span class="fu">&lt;|&gt;</span> (<span class="dt">Right</span> <span class="fu">&lt;$&gt;</span> intForm)</a></code></pre></div>
<p>From multiple forms, with <code>choice</code>:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb8-1" data-line-number="1"><span class="ot">oneOfMany ::</span> <span class="dt">Form</span> <span class="dt">Int</span></a>
<a class="sourceLine" id="cb8-2" data-line-number="2">oneOfMany <span class="fu">=</span> choice [intForm1, intForm2, intForm3]</a></code></pre></div>
<p>And create “optional” entries:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode haskell"><code class="sourceCode haskell"><a class="sourceLine" id="cb9-1" data-line-number="1"><span class="ot">optionalInt ::</span> <span class="dt">Form</span> (<span class="dt">Maybe</span> <span class="dt">Int</span>)</a>
<a class="sourceLine" id="cb9-2" data-line-number="2">optionalInt <span class="fu">=</span> optional intForm</a></code></pre></div>
<p>We get all of these capabilities <em>for free</em>! All we did was <em>define a single form element</em>, and <code>Alt</code> gives us the ability to combine them with <code>&lt;*&gt;</code>/<code>&lt;$&gt;</code>, create optional form items with <code>optional</code>, and create multiple form options with <code>&lt;|&gt;</code>!</p></div><footer><ul class="entry-series"></ul><ul class="tag-list"><li><a href="https://blog.jle.im/entries/tagged/functional-programming.html" class="tag-a-tag">#functional programming</a></li><li><a href="https://blog.jle.im/entries/tagged/ghcjs.html" class="tag-a-tag">#ghcjs</a></li><li><a href="https://blog.jle.im/entries/tagged/haskell.html" class="tag-a-tag">#haskell</a></li><li><a href="https://blog.jle.im/entries/tagged/types.html" class="tag-a-tag">#types</a></li><li><a href="https://blog.jle.im/entries/category/@haskell.html" class="tag-a-category">@HASKELL</a></li></ul><aside class="social-buttons"><div class="addthis_toolbox addthis_default_style addthis-buttons"><a class="addthis_button_facebook_like" fb:like:layout="button_count"></a><a class="addthis_button_tweet"></a><a class="addthis_button_google_plusone" g:plusone:size="medium"></a><a class="addthis_counter addthis_pill_style"></a></div><div class="custom-social-buttons"><div class="custom-social-button"><a href="https://www.reddit.com/submit" onclick="window.location = &#39;https://www.reddit.com/submit?url=&#39;+ encodeURIComponent(window.location); return false"><img src="https://www.reddit.com/static/spreddit7.gif" alt="submit to reddit"></a></div></div></aside><nav class="next-prev-links"><ul><li class="next-entry-link">(Next) <a href="https://blog.jle.im/entry/introducing-in-code.html">Introducing &quot;in Code&quot;!</a> &rarr;</li></ul></nav></footer></article><div class="post-entry"><div class="tile"><div id="disqus_thread"></div><script type="text/javascript">var disqus_config = function () {
    this.page.url = 'https://blog.jle.im/entry/forms-with-free-applicative-alternative.html';
    this.page.identifier = 'free-applicative-forms';
};
(function() {
    var d = document, s = d.createElement('script');
    s.src = '//incode.disqus.com/embed.js';
    s.setAttribute('data-timestamp', +new Date());
    (d.head || d.body).appendChild(s);
})();
</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a><br></noscript><a href="http://disqus.com" class="dsq-brlink">Comments powered by <span class="logo-disqus">Disqus</span></a></div></div></div></div></div><div id="footer-container"><div id="footer-content"><div class="tile"><div class="footer-copyright">&copy; 2016 Justin Le</div><div class="footer-follow social-follows"><ul class="social-follows-list"><li><ul class="social-follows-list-social"><li><a class="social-follow-twitter" title="Follow me on Twitter!" href="https://twitter.com/intent/user?user_id=mstk" onclick="window.open(
  &#39;http://twitter.com/intent/user?user_id=907281&#39;,
  &#39;facebook-share-dialog&#39;,
  &#39;width=550,height=520&#39;);
return false;
">Twitter</a></li><li><a class="social-follow-gplus" title="Add me on Google+!" href="https://plus.google.com/+JustinLe">Google+</a></li><li><a class="social-follow-linkedin" title="Connect with me on LinkedIn!" href="https://linkedin.com/in/lejustin">LinkedIn</a></li><li><a class="social-follow-github" title="Fork me on Github!" href="https://github.com/mstksg">Github</a></li><li><a class="social-follow-keybase" title="Track me on Keybase!" href="https://keybase.io/mstksg">Keybase</a></li><li><a class="social-follow-bitcoin" title="Donate via bitcoin!" href="https://coinbase.com/mstksg">Bitcoin</a></li></ul></li><li><ul class="social-follows-list-site"><li><a class="social-follow-rss" title="Subscribe to my RSS Feed!" href="http://feeds.feedburner.com/incodeblog">RSS</a></li><li><a class="social-follow-email" title="Subscribe to the mailing list!" href="https://feedburner.google.com/fb/a/mailverify?loc=en_US&amp;uri=incodeblog">Mailing list</a></li></ul></li></ul></div></div></div></div></body></html>