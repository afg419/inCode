\documentclass[]{article}
\usepackage{lmodern}
\usepackage{amssymb,amsmath}
\usepackage{ifxetex,ifluatex}
\usepackage{fixltx2e} % provides \textsubscript
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
\else % if luatex or xelatex
  \ifxetex
    \usepackage{mathspec}
    \usepackage{xltxtra,xunicode}
  \else
    \usepackage{fontspec}
  \fi
  \defaultfontfeatures{Mapping=tex-text,Scale=MatchLowercase}
  \newcommand{\euro}{â‚¬}
\fi
% use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
% use microtype if available
\IfFileExists{microtype.sty}{\usepackage{microtype}}{}
\usepackage[margin=1in]{geometry}
\ifxetex
  \usepackage[setpagesize=false, % page size defined by xetex
              unicode=false, % unicode breaks when used with xetex
              xetex]{hyperref}
\else
  \usepackage[unicode=true]{hyperref}
\fi
\hypersetup{breaklinks=true,
            bookmarks=true,
            pdfauthor={Justin Le},
            pdftitle={Abstract Validating Forms with Free Applicative/Alternative},
            colorlinks=true,
            citecolor=blue,
            urlcolor=blue,
            linkcolor=magenta,
            pdfborder={0 0 0}}
\urlstyle{same}  % don't use monospace font for urls
% Make links footnotes instead of hotlinks:
\renewcommand{\href}[2]{#2\footnote{\url{#1}}}
\setlength{\parindent}{0pt}
\setlength{\parskip}{6pt plus 2pt minus 1pt}
\setlength{\emergencystretch}{3em}  % prevent overfull lines
\setcounter{secnumdepth}{0}

\title{Abstract Validating Forms with Free Applicative/Alternative}
\author{Justin Le}

\begin{document}
\maketitle

\emph{Originally posted on
\textbf{\href{https://blog.jle.im/entry/forms-with-free-applicative-alternative.html}{in
Code}}.}

One tool I've been finding myself using a lot recently is the \emph{Free
Applicative} (and \emph{Free Alternative}), from the
\emph{\href{https://hackage.haskell.org/package/free}{free}} package.

Free Monads are great, and they're often used to implement the ``interpreter
pattern'' (although I personally prefer \emph{{[}operational{]}{[}{]}}, as I
wrote about in a
\href{https://blog.jle.im/entry/interpreters-a-la-carte-duet.html}{previous blog
post}, for that design pattern). However, Free Applicatives are really a
completely different type of thing, and the use cases for each are pretty
disjoint.

If I had to make a general statement, I'll say that free monads are especially
good at representing the idea of abstract \emph{sequential} generators
(sequences that are chained dependently one after the other), and that free
applicatives are especially good at representing the idea of abstract
\emph{parallel} generators (things operating in parallel without any
interconnected data dependences).

The general approach to utilizing the Free Applicative is to start with some
Functor \texttt{F} (\texttt{F\ a} represents the act of generating a value of
type \texttt{a}). Once you throw \texttt{F} into \texttt{Ap} (or \texttt{Alt})
to get \texttt{Ap\ F}, you now are able to \emph{combine \texttt{F}s in
parallel} with \texttt{\textless{}\$\textgreater{}},
\texttt{\textless{}*\textgreater{}}, \texttt{liftA2}, \texttt{sequence},
\texttt{traverse}, etc., even though \texttt{F} normally could not support such
combinations. Then, finally, you have the ability to provide a concrete
generator function
\texttt{forall\ a.\ Applicative\ f\ =\textgreater{}\ F\ a\ -\textgreater{}\ f\ a}
(given \texttt{F\ a}, return an actual generator of \texttt{a}s in some
\texttt{Applicative}), and the magic of the Free Applicative will go in and
actually run all of your combined \texttt{F} actions ``in parallel''. The trick
is that, with the same value of \texttt{Ap\ F\ a}, you can \emph{run multiple
different concrete generators} on it, so you can realize \texttt{Ap\ F} in
multiple different contexts and situations, adapting it for whatever you need.

For this post, I'll be talking about using the Free Applicative \texttt{Ap} (and
the Free Alternative, \texttt{Alt}) in order to generate an abstract
representation of a validating form, and leveraging this representation to
realize these forms in terminal IO, JSON/YAML, PDF documents, and even on the
browser using \emph{ghcjs} and
\emph{\href{https://hackage.haskell.org/package/miso}{miso}}.

\end{document}
